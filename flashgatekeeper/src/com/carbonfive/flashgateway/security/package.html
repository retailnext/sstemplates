<html>
<head>
<link rel="stylesheet" type="text/css" href="../../../../../properties/javadoc.css" title="style">
</head>
<body>
FlashGatekeeper is an implementation of a Servlet 2.3 Filter that provides an important Flash Remoting security solution by limiting the services that can be invoked by Flash clients through Macromedia Flash Remoting MX for J2EE and for ColdFusion J2EE Edition on any Java application server.

<h2><a name="documentation">FlashGatekeeper Security Filter for Macromedia Flash Remoting MX</a></h2>

FlashGatekeeper is designed to be used with <a target="_top" href="http://www.macromedia.com/software/flashremoting/">Macromedia Flash Remoting MX</a> on any J2EE application server. It allows developers to limit the services that can be invoked through Flash Remoting, providing an important Flash Remoting security solution. For details on why this is important, <a href="#history">read the history</a>.

<p>
FlashGatekeeper is supported by <a target="_top" href="http://www.carbonfive.com/opensource-main-1.html">Carbon Five</a> and can be deployed on application servers with Flash Remoting MX including Macromedia JRun, Jakarta Tomcat, JBoss, Caucho Resin, IBM WebSphere, BEA Weblogic and ATG Dynamo.

<ul>
<li><a href="#overview">Overview</a>
<li><a href="#history">History</a>
<li><a href="#download">Download</a>
<li><a href="#prerequisites">Prerequisites</a>
<li><a href="#install">Install</a>
<li><a href="#configure">Configure</a>
<li><a href="#support">Support</a>
<li><a href="#developers">Developers</a>
<li><a href="#releases">Release Notes</a>
<li><a href="#reference">Reference</a>
<li><a href="#credits">Credits</a>
</ul>

<hr size="1">

<h3><a name="overview">Overview</a></h3>

<p>
FlashGatekeeper gives developers the ability to limit the services that can be invoked through Flash Remoting. It provides the ability to restrict service access by Java package and class name, JNDI context or EJB name, to define exactly which service methods may be called and to restrict service method access by user role as determined by standard container managed security.
</p>

<p>
GatekeeperFilter is a standard Servlet 2.3 Filter that is designed to inspect the AMF messsage sent by a Flash MX client when trying to invoke a service in the servlet container through Macromedia Flash Remoting MX for J2EE. GatekeeperFilter uses classes included in the Flash Remoting flashgateway.jar distribution to parse and inspect AMF messages sent by the Flash client.
</p>

<p>
GatekeeperFilter only allows AMF messages that are trying to invoke a configured list of services to get to the Flash Remoting gateway. If it encounters an AMF request that it not allowed, it logs a warning with the full details of the service request and returns a <b>403 Forbidden</b> status to the client.
</p>

<h3><a name="history">History</a></h3>

<p>
Macromedia Flash Remoting is implemented as a servlet that uses introspection to invoke methods on a class in the application server. The class and method are both named by the Flash client. A Flash MX client can invoke any method through the Flash Remoting gateway on any class that has a no argument constructor and can therefore be created by the Flash Remoting gateway servlet using Class.forName("package.ClassName").newInstance( ). It can also invoke any method on any EJB home interface that it can find in JNDI.
</p>

<p>
This opens up many potential security issues. A malicious user could write a Flash client to access known core Java classes, classes in the application server APIs, or classes in your application. The potential exploits are numerous. A Flash client could access application server classes to manipulate the state of the server or gain access to protected information.
</p>

<p>
Using the core Java APIs a Flash client can connect to java.util.ArrayList as a Remoting service through Flash Remoting and invoke ArrayList.addAll(new Array("some string")) in an infinite loop. This is basically a denial of service attack that will fill up the memory available to the application server. Before long, it will crash the JVM (Java Virtual Machine) running the application server.
</p>

<p>
Macromedia's recommended approach for dealing with this security issue is to enable the Java Security Manager for your application server and edit the Java security policy file to limit the classes the Remoting gateway servlet can access. Unfortunately, the Java Security Manager will slow down your application server, security policy files are a pain to edit and manage, and you can't even prevent the ArrayList exploit above because the Remoting gateway needs access to ArrayList to function. The Security Manager can not distinguish between the gateway using a class as a Remoting service or as part of its written code.
</p>

<p>
Don't use the Security Manager solution. Use FlashGatekeeper.
</p>

<h3><a name="download">Download</a></h3>

The latest release of FlashGatekeeper is available for <a target="_top"  href="http://sourceforge.net/project/showfiles.php?group_id=52145&package_id=83134">download from SourceForge.net</a>. For the adventurous, you can check out the <a target="_top" href="http://sourceforge.net/cvs/?group_id=52145">latest changes from CVS</a> with module name 'flashgatekeeper'.

<h3><a name="prerequisites">Prerequisites</a></h3>

<p>
If you are not using Flash Remoting, you do not have a need for FlashGatekeeper. Get <a target="_top"  href="http://www.macromedia.com/software/flashremoting/downloads/">Flash Remoting for J2EE from Macromedia.</a>
</p>

<p>
FlashGatekeeper uses classes that are part of the Flash Remoting distribution and included in Flash Remoting's flashgateway.jar. Be sure to install Flash Remoting for your application by:
<ol>
<li>locating flashgateway.jar in the flashgateway.ear or flashgateway.war file installed by the Macromedia installer
<li>placing it in your web application's WEB-INF/lib/ directory
<li>mapping the gateway for your web application by adding the following to your web application's WEB-INF/web.xml file:

<pre class="code">
  &lt;servlet>
    &lt;servlet-name>FlashGatewayServlet&lt;/servlet-name>
    &lt;servlet-class>flashgateway.controller.GatewayServlet&lt;/servlet-class>
  &lt;/servlet>

  &lt;servlet-mapping>
    &lt;servlet-name>FlashGatewayServlet&lt;/servlet-name>
    &lt;url-pattern>/gateway&lt;/url-pattern>
  &lt;/servlet-mapping>
</pre>
</ol> 
</p>

<p>
FlashGatekeeper also utilizes specific components from other open source projects.  These libraries are provided in the distribution, and can be freely used by commercial and non-commercial applications.  More information can be found here:
<ul>
<li>Jakarta Commons Logging - <a target="_top" href="http://jakarta.apache.org/commons/logging.html">home page</a>
<li>Jakarta Commons Digester - <a target="_top" href="http://jakarta.apache.org/commons/digester.html">home page</a>
<li>Jakarta Commons Collections - <a target="_top" href="http://jakarta.apache.org/commons/collections.html">home page</a>
<li>Jakarta Commons BeanUtils - <a target="_top" href="http://jakarta.apache.org/commons/beanutils.html">home page</a>
</ul>

<p>
FlashGatekeeper uses Jakarta Commons Digester to parse its configuration. Digester requires an XML parser conforming to JAXP , version 1.1 or later (the first one to support SAX 2.0). You're application server probably already has one so you probably don't need to worry about getting one. If you turn out to need one, <a target="_top" href="http://xml.apache.org/xerces2-j/index.html">Xerces</a> will do the job. 


<h3><a name="install">Install</a></h3>

To install FlashGatekeeper unzip flashgatekeeper-x.x.zip and copy the following jars to your web application's WEB-INF/lib/ directory:
<ul>
<li>lib/flashgatekeeper-x.x.jar
<li>lib/commons-logging.jar
<li>lib/commons-digester.jar
<li>lib/commons-collections.jar
<li>lib/commons-beanutils.jar
</ul>

<p>
Configure FlashGatekeeper in your application's WEB-INF/web.xml file as a servlet filter mapped to the URL of the Flash Remoting gateway servlet. For example:
</p>

<pre class="code">
  &lt;filter>
    &lt;filter-name>GatekeeperFilter&lt;/filter-name>
    &lt;filter-class>com.carbonfive.flashgateway.security.GatekeeperFilter&lt;/filter-class>
    &lt;init-param>
      &lt;param-name>config-file&lt;/param-name>
      &lt;param-value>flashgatekeeper.xml&lt;/param-value>
    &lt;/init-param>
  &lt;/filter>

  &lt;filter-mapping>
    &lt;filter-name>GatekeeperFilter&lt;/filter-name>
      &lt;url-pattern>/gateway&lt;/url-pattern>
  &lt;/filter-mapping>
</pre>

<p>
FlashGatekeeper looks for its configuration file in the classpath of your web application. In this example, you would put <i>flashgatekeeper.xml</i> in WEB-INF/classes or in another directory in your web applications classpath.
</p>


<h3><a name="configure">Configure</a></h3>

<p>
FlashGateway configuration allows you to define service access with a number of options.
</p>

<p>
A simple <i>flashgatekeeper.xml</i> configuration file that allows access to all services and service methods to all users restricted to the <tt>com.carbonfive.services</tt> package follows:
</p>

<pre class="code">
&lt;config>
  &lt;service>
    &lt;name>com.carbonfive.services&lt;/name>
    &lt;method>
      &lt;name>*&lt;/name>
    &lt;/method>
  &lt;/service>
&lt;/config>
</pre>

A following <i>flashgatekeeper.xml</i> configuration file shows the range of configuration options.

<pre class="code">
&lt;config>
  &lt;service>
    &lt;name>com.carbonfive.AllowAllService&lt;/name>
    &lt;method>
      &lt;name>*&lt;/name>
    &lt;/method>
  &lt;/service>
  &lt;service>
    &lt;name>com.carbonfive.RestrictedService&lt;/name>
    &lt;method>
      &lt;name>allowAllMethod&lt;/name>
    &lt;/method>
    &lt;method>
      &lt;name>restrictedMethod&lt;/name>
      &lt;access-constraint>
        &lt;role-name>ADMIN&lt;/role-name>
        &lt;role-name>MANAGER&lt;/role-name>
      &lt;/access-constraint>
    &lt;/method>
  &lt;/service>
  &lt;service>
    &lt;name>com.carbonfive.services&lt;/name>
    &lt;method>
      &lt;name>*&lt;/name>
      &lt;access-constraint>
        &lt;role-name>USER&lt;/role-name>
      &lt;/access-constraint>
    &lt;/method>
  &lt;/service>
  &lt;service>
    &lt;name>webapp&lt;/name>
    &lt;method>
      &lt;name>*&lt;/name>
    &lt;/method>
  &lt;/service>
  &lt;service>
    &lt;name>java:comp/env/ejb&lt;/name>
    &lt;method>
      &lt;name>*&lt;/name>
    &lt;/method>
  &lt;/service>
&lt;/config>
</pre>

This sample configuration defines five service configurations.

<ol>
<li>com.carbonfive.AllowAllService<br>
is a Java service and all service methods are allowed.
<p>
<li>com.carbonfive.RestrictedService<br>
is a Java service with two service methods permitted. allowAllMethod may be called by any user. restrictedMethod may only be called by users that are logged in and have the role ADMIN or MANAGER as determined by container managed authentication.
<p>
<li>com.carbonfive.services<br>
is a package name. All services in this package are permitted and all methods may be called in all of those services as long as the user is logged in with the USER role.
<p>
<li>webapp<br>
is a web application name and allows access to all servlet services in that web application.
<p>
<li>java:comp/env/ejb<br>
is a JNDI name and allows access to all EJB services under that JNDI context. You may also specify the full JNDI name of an EJB to restrict access to just that EJB.
</ol>

<h3><a name="support">Support</a></h3>

For support, please read and post to the <a target="_top"  href="http://sourceforge.net/forum/forum.php?forum_id=277508">forums on SourceForge.net</a>.

<h3><a name="developers">Developers</a></h3>

For those interesting in peeking under the hood or making changes, the <a href="#download">distribution</a> includes the source code, an Ant build script and JUnit unit tests that can be used to make changes. Simply unzip the distribution to get started.

<h3><a name="releases">Release Notes</a></h3>

<h4>FlashGatekeeper 0.4</h4>

<ul>
<li>Switched to XML configuration
<li>Added Digester configuration parsing
<li>Added role-based restrictions
</ul>

<h4>FlashGatekeeper 0.3</h4>

<ul>
<li>Removed dependency on openAMF - using flashgateway.jar classes for deserialization
</ul>

<h4>FlashGatekeeper 0.2</h4>

<ul>
<li>Initial public release of FlashGatekeeper on SourceForge.
</ul>

<h3><a name="reference">Reference</a></h3>

<ul>
<li> <a href="http://www.onjava.com/pub/a/onjava/2003/02/26/flash_remoting.html">Flash Remoting for J2EE Developers</a><br/>
     O'Reilly OnJava article.</li>

<li> <a href="http://www.macromedia.com/software/flashremoting/">Flash Remoting MX Homepage</a><br/>
     Macromedia resource.</li>

<li> <a href="http://www.macromedia.com/software/trial_download/">Download Flash Remoting MX</a><br/>
     Macromedia resource.</li>

<li> <a href="http://www.macromedia.com/desdev/mx/blackboard/articles/flash_remoting_design_2.0.html">Flash Remoting 101 for Java Users</a><br/>
     Macromedia resource.</li>

<li> <a href="http://www.macromedia.com/software/flashremoting/whitepapers/pdf/flr_j2ee.pdf">A Technical Overview of Flash Remoting MX for Java Developers</a> (PDF)<br/>
     Macromedia resource.</li>

<li> <a href="http://www.macromedia.com/support/flash_remoting/ts/documents/presalesfaq.htm">Common Questions About Flash Remoting</a><br/>
     Macromedia resource.</li>

<li> <a href="http://www.macromedia.com/support/flash_remoting/ts/documents/presalesfaq.htm#jrunrestriction">Modifying Java Security Policy for Remoting</a><br/>
     Macromedia resource.</li>

</ul>

<h3><a name="credits">Credits</a></h3>

Alon J Salant, <a href="http://www.carbonfive.com">Carbon Five</a><br>
Sam Borgeson, <a href="http://www.carbonfive.com">Carbon Five</a><br>

</body>
</html>